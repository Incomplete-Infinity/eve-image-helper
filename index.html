<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EVE Image Resolver Demo</title>

    <!-- Halfmoon CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/halfmoon@2.0.2/css/halfmoon.min.css"
      rel="stylesheet"
      integrity="sha256-RjeFzczeuZHCyS+Gvz+kleETzBF/o84ZRHukze/yv6o="
      crossorigin="anonymous"
    />
    <!-- Halfmoon core themes -->
    <link
      href="https://cdn.jsdelivr.net/npm/halfmoon@2.0.2/css/cores/halfmoon.cores.css"
      rel="stylesheet"
      integrity="sha256-MAzAVJMU/ze52ZHcA8CeqRrCOVndMZlHwNeS2c73vP4="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/topcoat/0.8.0/css/topcoat-desktop-dark.min.css"
      integrity="sha512-Cwdrdy7iqIj7n5XjgDqvpCOO4aztpoIISOcabdx5igD8Z51YuOWa8BBbI8+2oOI6Rf77xMZ1vAlXvGn6jc6O5Q=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script src="./src/eve-image-helper.js"></script>
  </head>
  <body data-bs-theme="dark" data-bs-core="modern">
    <main class="text-body px-4">
      <header>
        <h1>EVE Image Resolver</h1>
      </header>
      <div class="row bg-primary-subtle rounded-5 m-3">
        <div
          class="col-12 bg-info bg-opacity-25 rounded-5 rounded-bottom-0 border border-info row g-0 mx-auto p-3"
        >
          <div class="col-6 col-md-8 col-lg-9">
            <div
              class="h-100 bg-secondary bg-opacity-50 border border-info border-end-0 rounded rounded-end-0 p-4"
            >
              <h2 class="mb-3">What This Does</h2>
              <p class="bg-body rounded">
                This tool takes an EVE Online ID and determines which image
                formats are available using basic
                <a
                  href="https://docs.esi.evetech.net/docs/image_server.html"
                  target="_blank"
                  rel="noopener"
                  >ESI</a
                >
                lookups. It supports a wide range of in-game entities like
                characters, corporations, alliances, item types, blueprints, and
                ancient relics.
              </p>
              <p class="bg-body rounded">
                The script first resolves the category (e.g. <em>character</em>,
                <em>corporation</em>, <em>inventory_type</em>) then determines
                the appropriate image variants. For inventory types, it performs
                additional lookups to identify ships, blueprints, and relics
                specifically â€” ensuring the most accurate URL formation.
              </p>
              <p class="bg-body rounded">
                Ships will return both <strong>icon</strong> and
                <strong>render</strong> images. Blueprints return
                <strong>bp</strong> and <strong>bpc</strong> formats. Ancient
                relics return a <strong>relic</strong> image. Other IDs resolve
                to <strong>portraits</strong> or <strong>logos</strong> as
                appropriate.
              </p>
            </div>
          </div>
          <div class="col-6 col-md-4 col-lg-3">
            <div
              class="card h-100 bg-secondary bg-opacity-50 border border-info border-start-0 rounded rounded-start-0"
            >
              <div class="card-header rounded-start-0">
                Supported ID Categories
              </div>
              <div class="card-body">
                <ul class="topcoat-list__container list-group bg-body">
                  <li class="topcoat-list__item list-group-item">Character</li>
                  <li class="topcoat-list__item list-group-item">
                    Corporation
                  </li>
                  <li class="topcoat-list__item list-group-item">Alliance</li>
                  <li class="topcoat-list__item list-group-item">
                    Faction (NPC Corp)
                  </li>
                  <li class="topcoat-list__item list-group-item">
                    Type (Item)
                  </li>
                  <li class="topcoat-list__item list-group-item">Blueprint</li>
                  <li class="topcoat-list__item list-group-item">
                    Ancient Relic
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <fieldset id="resolver-form" class="mb-4">
          <div class="row g-3 align-items-center">
            <div class="col-sm-7 col-md-8 col-lg-9">
              <input
                type="number"
                class="form-control topcoat-text-input--large"
                list="id-suggestions"
                id="input-id"
                placeholder="Enter EVE ID"
                required
              />
              <datalist id="id-suggestions">
                <option value="434243723">Alliance: 434243723</option>
                <option value="109299958">Corporation: 109299958</option>
                <option value="500001">Faction (NPC Corp): 500001</option>
                <option value="1338057886">Character: 1338057886</option>
                <option value="587">Rifter (type): 587</option>
                <option value="3082">250mm Railgun II (type): 3082</option>
                <option value="11568">Avatar Blueprint (type): 11568</option>
                <option value="30752">Intact Hull Section (type): 30752</option>
              </datalist>
            </div>
            <div
              class="col-sm-5 col-md-4 col-lg-3 d-flex justify-content-start"
            >
              <div id="spinner-container" class="d-none text-center">
                <div class="spinner-border"></div>
              </div>
              <div id="button-container">
                <button
                  id="resolve-button"
                  class="btn btn-primary topcoat-button--large"
                  type="submit"
                >
                  Resolve Image
                </button>
              </div>
            </div>
          </div>
        </fieldset>
        <div id="result">
          <table
            class="table table-striped table-striped-columns table-hover"
            border="1"
            cellpadding="6"
          >
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Variant</th>
                <th scope="col">URL</th>
                <th scope="col" class="text-end">Preview</th>
              </tr>
            </thead>
            <tbody id="result-body"></tbody>
          </table>
        </div>
      </div>

      <footer class="text-center mt-5">
        <p class="mb-0">
          Created by
          <a href="https://github.com/PhobiaCide" target="_blank" rel="noopener"
            >PhobiaCide</a
          >
        </p>
      </footer>
    </main>
    <script defer>
      let runCount = 0;

      const btn = document.getElementById("resolve-button");
      const input = document.getElementById("input-id");
      const resultBody = document.getElementById("result-body");
      const spinnerContainer = document.getElementById("spinner-container");
      const buttonContainer = document.getElementById("button-container");

      btn.onclick = async () => {
        const id = Number(input.value);
        input.value = ""; // Clear the input for new entry
        if (!id) return alert("Enter a valid numeric ID");

        buttonContainer.classList.toggle("d-none");
        spinnerContainer.classList.toggle("d-none");

        const resolver = await Image.create(id);
        const variants = resolver.variants;

        if (!Object.keys(variants).length) {
          alert("No image variants available.");
          return;
        }

        const rows = Object.entries(variants)
          .map(([key, url]) => {
            runCount++;
            return `
          <tr>
            <th scope="row">${runCount}</th>
            <td>${key}</td>
            <td><a href="${url}" target="_blank">${url}</a></td>
            <td class="text-end"><img src="${url}" alt="${key}" style="max-height:100px" /></td>
          </tr>
        `;
          })
          .join("");

        resultBody.insertAdjacentHTML("beforeend", rows);

        buttonContainer.classList.toggle("d-none");
        spinnerContainer.classList.toggle("d-none");
      };
    </script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha256-whL0tQWoY1Ku1iskqPFvmZ+CHsvmRWx/PIoEvIeWh4I="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha256-3gQJhtmj7YnV1fmtbVcnAV6eI4ws0Tr48bVZCThtCGQ="
      crossorigin="anonymous"
    ></script>
  </body>
</html>
